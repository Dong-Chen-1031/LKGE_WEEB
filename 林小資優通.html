<!DOCTYPE html>
<!-- https://www.oxxostudio.tw/articles/201905/firebase-firestore.html -->
<!-- https://dong-chen-1031.github.io/LKGE_WEEB/林小資優通.html -->
<html>
<head>
    <title>林小資優通</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-firestore.js"></script>
    <!-- <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/4.12.1/firebase-auth.js"></script>
    <style>
        table{border-collapse: collapse;}
        .booktd{height: 20px;width: 16%;border: 2px solid #092846;}
        .bookt{font-size: 20px;color: #f5f5f5;}
        .booktable{margin-left: auto;margin-right: auto;width: 95%;}
        .bookdiv{margin-left: auto;margin-right: auto;width: 100%;}
        tr:nth-child(2){height: 300px;}
        tr:nth-child(1){text-align: center;font-size: 18px;}
        .huse{width: 10%; height: auto;font-size: 10px;background-color: #cf7c1d;margin: 5px;
            font-size: 20px;color: #f5f5f5}
        .hdiv{width: 90%;margin-left: auto;margin-right: auto;}
        .bodydiv{background-color: #f5f5f5;width: 90%;height: 90%;margin-left: auto;margin-top: 10px
            ;margin-right: auto;}
        .login{margin-left: auto;width: 20%;background-color: #cf7c1d;}
        .center{text-align: center;margin-left: auto;margin-right: auto;margin-top: auto;margin-bottom: auto;}
        .goldimg{width: 20px;height: 20px;margin-top: auto;margin-bottom: auto;}
        .loginimg{width: 35px;height: 30px;margin-top: auto;margin-bottom: auto; cursor: pointer;}
        .xhr{height: 30%;margin-top: auto;margin-bottom: auto;background-color: #f5f5f5;border: 0px;}
        .logintext{color: #f5f5f5;font-size: 20px;}
        body{height: 100%;background-color: #092846;}
        html{height: 100%;}
        .flex {margin-left: auto;margin-right: auto;
            display: flex;flex-direction: row;justify-content:flex-start;}
        .flexitem {display: flex;}
        .himg{height: 70px;width: 10%;}
        .booktd>textarea{font-family:sans-serif;width:90%;height: 90%;background-color: #f5f5f5;
            text-align: center;font-size: 18px;margin-left: auto;margin-right: auto;border: 0px;}
        .bookst{width: 3%;border: 2px solid #092846;text-align: center;}
        .bookst>img{height: 30px;cursor: pointer;}
        .bookmemus{width: 90%;height: 5%;justify-content:center;padding-top: 10px;padding-bottom: 10px;}
        .booktdiv{border-radius: 10px;background-color: #388ce1;width:8%;cursor: pointer;}
        .bookmemu{margin-left: 10px;margin-right: 10px;}
        .TeMane{font-size: 2px;margin-bottom: 20px;}
        .TeManes{margin-top: 10px;margin-left: 15px;font-size: 20px;margin-bottom: 5px;border: 1px red solid;color: red;display: none;}
    </style>
    <base href="https://dong-chen-1031.github.io/LKGE_WEEB/">
</head>
<body>
    <div class="hdiv flex">
        <div class="flexitem himg"><img src="圖片/image-removebg-preview.png"></div>
        <div class="flexitem huse" style="cursor: not-allowed;"><div class="center">電子聯絡簿</div></div>
        <div class="flexitem huse" style="cursor: not-allowed;"><div class="center">資優商城</div></div>
        <div class="flexitem huse" style="cursor: not-allowed;"><div class="center">班幣存摺</div></div>
        <div class="flexitem huse" style="cursor: not-allowed;"><div class="center">線上請假</div></div>
        <div class="flexitem login">
            <p class="center logintext" id='name'>請先登入</p>
            <hr width="1" class="xhr">
            <img class="goldimg" src="圖片/coin.png"></img>
            <p id="gold" class="center logintext">--</p>
            <img src="圖片/登入.png" onclick="Login()" class="loginimg">
        </div>
    </div>
    <div class="bodydiv">
        <!-- 聯絡簿 -->
        <div class="bookdiv" id="book">
            <div class="bookmemus flex">
                <div class="flexitem bookmemu booktdiv"><p class="bookt center">上一週</p></div>
                <div class="flexitem bookmemu booktdiv"><p class="bookt center">儲存</p></div>
                <div class="flexitem bookmemu booktdiv" style="cursor: default;"><p class="bookt center">第<span id="week">　</span>週</p></div>
                <div class="flexitem bookmemu booktdiv"><p class="bookt center">更新</p></div>
                <div class="flexitem bookmemu booktdiv"><p class="bookt center">下一週</p></div>
            </div>
            <table class="booktable">
                <tr>
                    <td id="1-1" class="booktd" colspan="2">10/19 獨立研究</td>
                    <td id="1-2" class="booktd" colspan="2"></td>
                    <td id="1-3" class="booktd" colspan="2"></td>
                    <td id="1-4" class="booktd" colspan="2"></td>
                    <td id="1-5" class="booktd" colspan="2"></td>
                </tr>
                <tr>
                    <td class="bookst">
                        準<br>時<br>：<br><img src="圖片/星-白.jpg" id="2-1-star-1" onclick="start(this)">
                        班<br>規<br>：<br><img src="圖片/星-白.jpg" id="2-1-star-2" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-1-star-3" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-1-star-4" onclick="start(this)">
                        作<br>業<br>：<br><img src="圖片/星-白.jpg" id="2-1-star-5" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-1-star-6" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-1-star-7" onclick="start(this)">
                    </td>
                    <td class="booktd"><textarea id="2-1" oninput='寫入_聯絡簿(this)'>t&#13;&#10;ttt</textarea></td>
                    <td class="bookst">
                        準<br>時<br>：<br><img src="圖片/星-白.jpg" id="2-2-star-1" onclick="start(this)">
                        班<br>規<br>：<br><img src="圖片/星-白.jpg" id="2-2-star-2" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-2-star-3" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-2-star-4" onclick="start(this)">
                        作<br>業<br>：<br><img src="圖片/星-白.jpg" id="2-2-star-5" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-2-star-6" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-2-star-7" onclick="start(this)">
                    </td>
                    <td class="booktd"><textarea id="2-2" oninput='寫入_聯絡簿(this)'></textarea></td>
                    <td class="bookst">
                        準<br>時<br>：<br><img src="圖片/星-白.jpg" id="2-3-star-1" onclick="start(this)">
                        班<br>規<br>：<br><img src="圖片/星-白.jpg" id="2-3-star-2" onclick="start(this)">
                                     <br><img src="圖片/星-白.jpg" id="2-3-star-3" onclick="start(this)">
                                     <br><img src="圖片/星-白.jpg" id="2-3-star-4" onclick="start(this)">
                        作<br>業<br>：<br><img src="圖片/星-白.jpg" id="2-3-star-5" onclick="start(this)">
                                     <br><img src="圖片/星-白.jpg" id="2-3-star-6" onclick="start(this)">
                                     <br><img src="圖片/星-白.jpg" id="2-3-star-7" onclick="start(this)">
                    </td>
                    <td class="booktd"><textarea id="2-3" oninput='寫入_聯絡簿(this)'></textarea></td>
                    <td class="bookst">
                        準<br>時<br>：<br><img src="圖片/星-白.jpg" id="2-4-star-1" onclick="start(this)">
                        班<br>規<br>：<br><img src="圖片/星-白.jpg" id="2-4-star-2" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-4-star-3" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-4-star-4" onclick="start(this)">
                        作<br>業<br>：<br><img src="圖片/星-白.jpg" id="2-4-star-5" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-4-star-6" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-4-star-7" onclick="start(this)">
                    </td>
                    <td class="booktd"><textarea id="2-4" oninput='寫入_聯絡簿(this)'></textarea></td>
                    <td class="bookst">
                        準<br>時<br>：<br><img src="圖片/星-白.jpg" id="2-5-star-1" onclick="start(this)">
                        班<br>規<br>：<br><img src="圖片/星-白.jpg" id="2-5-star-2" onclick="start(this)">
                                     <br><img src="圖片/星-白.jpg" id="2-5-star-3" onclick="start(this)">
                                     <br><img src="圖片/星-白.jpg" id="2-5-star-4" onclick="start(this)">
                        作<br>業<br>：<br><img src="圖片/星-白.jpg" id="2-5-star-5" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-5-star-7" onclick="start(this)">
                                      <br><img src="圖片/星-白.jpg" id="2-5-star-6" onclick="start(this)">
                    </td>
                    <td class="booktd"><textarea id="2-5" oninput='寫入_聯絡簿(this)'></textarea></td>
                </tr>
                <tr>
                    <td id="1-5" class="booktd" colspan="2">
                        <div class="flex">
                            <p class="TeMane flexitem">授課教師簽名</p>
                            <div class="TeManes"  id="3-1-div"><small>教師</small> <span id="3-1-name">傅蓉</span></div>
                        </div>
                    </td>
                    <td id="1-5" class="booktd" colspan="2">
                        <div class="flex">
                            <p class="TeMane flexitem">授課教師簽名</p>
                            <div class="TeManes"  id="3-2-div"><small>教師</small> <span id="3-2-name">傅蓉</span></div>
                        </div>
                    </td>
                    <td id="1-5" class="booktd" colspan="2">
                        <div class="flex">
                            <p class="TeMane flexitem">授課教師簽名</p>
                            <div class="TeManes" id="3-3-div"><small>教師</small> <span id="3-3-name">傅蓉</span></div>
                        </div>
                    </td>
                    <td id="1-5" class="booktd" colspan="2">
                        <div class="flex">
                            <p class="TeMane flexitem">授課教師簽名</p>
                            <div class="TeManes"  id="3-4-div"><small>教師</small> <span id="3-4-name">傅蓉</span></div>
                        </div>
                    </td>
                    <td class="booktd" colspan="2">
                        <div class="flex">
                            <p class="TeMane flexitem">授課教師簽名</p>
                            <div class="TeManes"  id="3-5-div"><small>教師</small> <span id="3-5-name">傅蓉</span></div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td id="1-1" class="booktd" colspan="2"></td>
                    <td id="1-2" class="booktd" colspan="2"></td>
                    <td id="1-3" class="booktd" colspan="2"></td>
                    <td id="1-4" class="booktd" colspan="2"></td>
                    <td id="1-5" class="booktd" colspan="2"></td>
                </tr>
            </table>
        </div>
        <!-- 登入 -->
        <div>
        </div>
    </div>
    <p id="javascript-01" style="display: none;"></p>
    <script>
        // 連線firebase
        var firebaseConfig = {
            apiKey: "AIzaSyBmv5-WRZerKSW4irXeZHTv1XRgKhJGX3A",
            authDomain: "lkge-web.firebaseapp.com",
            projectId: "lkge-web",
            storageBucket: "lkge-web.appspot.com",
            messagingSenderId: "218155008667",
            appId: "1:218155008667:web:f6780622aab1eef9307c3e",
            measurementId: "G-ENCNFFQB8C"
        };
        firebase.initializeApp(firebaseConfig);
        var db = firebase.firestore();
        //設置變數
        var return1
        var uid
        var username 
        var 目錄 = {}
        var userarr = {}
        var llb = {}
        var week = 1
        var b聯絡簿 = {}
        //取得基本資料
        var ref = db.collection('目錄');
        ref.get().then(querySnapshot => {
            querySnapshot.forEach(doc => {
                目錄[doc.id] = doc.data()
            });
        });
    </script>
    <script>
        //寫入聯絡簿
        function 寫入_聯絡簿(輸入框){
            let t輸入資料 = '';
            let t輸入內容_已切 = 輸入框.value.split('\n');
            for (let 次 = 0; 次 < t輸入內容_已切.length; 次++) {
                let for資料 = t輸入內容_已切[次];
                t輸入資料 = t輸入資料 + for資料 + '&#13;&#10;'
            }
            let t輸入id = 輸入框.id.split('-')[1];
            let t輸出資料 = {
                內容:t輸入資料
            }
            setdb(t輸出資料,'Dong Chen','第'+week+'周第'+t輸入id+'堂')
            console.log(t輸入id)
        };
        function start(t){
            if (username!=undefined){
                console.log(b聯絡簿)
                tname = t.id.split('-')
                b聯絡簿['第'+week+'周'+'第'+tname[1]+'堂']
            }
        };

        //登入
        function Login(){
            const provider = new firebase.auth.GoogleAuthProvider();
            firebase.auth().signInWithPopup(provider)
            .then((result) => {
                var user = result.user;
                uid = user.uid;
                console.log(uid);
                username = 目錄['學生'][uid]; 
                console.log(username);
                document.getElementById('name').innerText = username;
                db.collection(username).get().then(querySnapshot => {
                    querySnapshot.forEach(doc => {
                        userarr[doc.id] = doc.data();
                    });
                });
                setTimeout(function(){
                    var star_b = '%E5%9C%96%E7%89%87/%E6%98%9F-%E9%BB%91.jpg' 
                    document.getElementById('gold').innerText = userarr['班幣']['班幣']
                    document.getElementById('week').innerText = week
                    for (var index = 1; index < 6; index++) {
                        var user2 = userarr['第1周第'+String(index)+'堂']
                        b聯絡簿['第1周第'+String(index)+'堂'] = user2
                        document.getElementById('1-'+String(index)).innerText = user2['名稱']
                        document.getElementById('2-'+String(index)).innerHTML = user2['內容']
                        if(user2['教師簽章'] != null){
                            document.getElementById('3-1-div').style.display = 'block';
                            document.getElementById('3-1-name').innerText = user2['教師簽章'];
                        };
                        if (user2['準時'][0]){
                            document.getElementById('2-1-star-1').src = star_b ;
                        }; 
                        for (var t = 0; t < user2['班規'].length; t++) {
                            let if_star = user2['班規'][t];
                            if (if_star){
                                document.getElementById('2-1-star-'+String(2+t)).src = star_b ;
                            };
                        };
                        for (var t = 0; t < user2['作業'].length; t++) {
                            let if_star = user2['作業'][t];
                            if (if_star){
                                document.getElementById('2-1-star-'+String(5+t)).src = star_b ;
                            };
                        };
                    }
                    
                },5000)
                
            }).catch((error) => {
                console.log('111');
            })
        }

        //firebase 功能
        function setdb(t輸入資料,coll,doc){ //寫入資料
            let db路徑 = db.collection(coll).doc(doc);
            db路徑.set(t輸入資料,{merge:true}).then(() => {
                console.log('set data successful');
            });
        }
    </script>
</body>
</html>